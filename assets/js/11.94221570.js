(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{413:function(t,a,s){t.exports=s.p+"assets/img/1.7709d3c4.jpg"},414:function(t,a,s){t.exports=s.p+"assets/img/2.c2a2f0d7.jpg"},415:function(t,a,s){t.exports=s.p+"assets/img/3.f2d65fc3.jpg"},416:function(t,a,s){t.exports=s.p+"assets/img/4.5e454685.jpg"},417:function(t,a,s){t.exports=s.p+"assets/img/5.0fd2c65a.jpg"},418:function(t,a,s){t.exports=s.p+"assets/img/6.71198a7f.jpg"},419:function(t,a,s){t.exports=s.p+"assets/img/7.b4541dab.jpg"},562:function(t,a,s){"use strict";s.r(a);var e=s(56),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"three-js通过点击改变一个面的材质"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#three-js通过点击改变一个面的材质"}},[t._v("#")]),t._v(" Three.js通过点击改变一个面的材质")]),t._v(" "),e("p",[t._v("之前暑假用WebGL做了一个家居设计，为此专门去学习了three.js。过程中遇到了很多问题坎坎坷坷最后也都解决了，其中有一个捣鼓了很久的情况是这样的：")]),t._v(" "),e("p",[t._v("有一面空白的墙（就是一个立方体geometry），实现用鼠标点击这面墙的一面就能为其添加选中的墙纸。效果如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(413),alt:"img"}}),t._v("图1")]),t._v(" "),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(414),alt:"img"}}),t._v("图2")]),t._v(" "),e("p",[t._v("刚刚开始的时候并没有搞懂的一个概念就是"),e("strong",[t._v("face")]),t._v("。导致走了很多弯路。简单来说，在Threejs中，一个普通的方形面由两个三角形组成，其中一个三角形就是一个face。如下面的1和2")]),t._v(" "),e("p",[e("img",{attrs:{src:s(415),alt:"img"}}),t._v(" 图3")]),t._v(" "),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("p",[t._v("更复杂的面由更多的三角形("),e("strong",[t._v("face")]),t._v(")组成，比如上面抠去了一个窗的墙。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(416),alt:"img"}}),t._v(" 图4")]),t._v(" "),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("p",[t._v("要实现鼠标点击改变墙纸，在Threejs中要通过鼠标点击实现的效果，那基本少不了"),e("strong",[t._v("raycaster.intersectObjects(XXX，false)")]),t._v("。"),e("strong",[t._v("intersectObjects")]),t._v("函数返回射线"),e("strong",[t._v("raycaster")]),t._v("从起点向终点发出的射线碰到的所有"),e("strong",[t._v("XXX的子类")]),t._v("组成的数组。第二个参数默认为false，改为true还可以遍历子类的子类，关于"),e("strong",[t._v("raycaster")]),t._v("的使用网上有很多专门说明的文章，这里就不赘述了。")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("raycaster"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setFromCamera")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" mouse"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" camera3D "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" Choosed "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" raycaster"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("intersectObjects")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("XX")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("p",[t._v("我们需要的只是数组中的第一个对象"),e("strong",[t._v("Choosed[0]")]),t._v("，射线碰到的第一个物体，也是从我们的视角看，鼠标点到的第一个物体。")]),t._v(" "),e("p",[t._v("打印一下**Choosed[0]**能看到")]),t._v(" "),e("p",[e("img",{attrs:{src:s(417),alt:"img"}}),t._v(" 图5")]),t._v(" "),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("p",[t._v("其中的face就是指鼠标点击到的物体（下面的object）的face。face下的属性abc是这个面的法向量，下面的normal是(a,b,c)的归一化(单位化)。标注出来的"),e("strong",[t._v("materialIndex")]),t._v("就是对应object中的material的序号。要注意的是，对于一个原始的object，它的material并不是数组形式（图7）。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(418),alt:"img"}}),t._v(" 图6\n这个object添加了额外的material，类型是Array")]),t._v(" "),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(419),alt:"img"}}),t._v(" 图7\n这个object没有添加额外的material\n类型是Object")]),t._v(" "),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("p",[t._v("要在"),e("strong",[t._v("material")]),t._v("中保存多个材质图，需要进行如下的操作。")]),t._v(" "),e("p",[t._v("假设我们想要object同时存储 material1 和 material2")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" material01 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("THREE"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MeshBasicMaterial")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("map")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("texture01"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" material02 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("THREE"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MeshBasicMaterial")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("map")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("texture02"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" materials "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmaterials"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("material01"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmaterials"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("material02"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nChoosed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("material "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" materials"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这样material就能存储多个材质")]),t._v("\n")])])]),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("p",[t._v("之后改变图5中 face的"),e("strong",[t._v("materialIndex")]),t._v("即可改变其对应的"),e("strong",[t._v("material")])]),t._v(" "),e("p",[t._v("而要改变一面整墙的材质，需要遍历"),e("strong",[t._v("faces")]),t._v("，找出其中和 "),e("strong",[t._v("face")]),t._v("的"),e("strong",[t._v("normal")]),t._v("相同的"),e("strong",[t._v("face")]),t._v(" 并改变其"),e("strong",[t._v("materialIndex")])]),t._v(" "),e("p",[t._v("PS：因为精度的问题，一面墙上的两个face可能朝着同一面但两者的normal会有偏差。例如图3的1和2法向量分别为(1,1.000,1)和(1,1.001,1)，这种情况写个函数精确到某一位再来比较就行了。")]),t._v(" "),e("p",[e("strong",[t._v("在改变后需要将geometry的groupsNeedUpdate属性设置为true来告知渲染器该对象需要更新")])]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("Choosed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("geometry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("groupsNeedUpdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[e("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("当初在这里卡了大概有一周左右，毕竟是刚刚开始接触Threejs，网上百度相关的资料来来回回就是那几篇，很多概念没搞懂就冲上去瞎搞。(。＿ 。）在最后从Threejs的doc里面一条一条的看，偶然看到了face的那一条才恍然大悟。")]),t._v(" "),e("p",[t._v("虽然大悟后弯路也没少走就是了......")]),t._v(" "),e("p",[t._v("参考: "),e("a",{attrs:{href:"https://threejs.org/docs",target:"_blank",rel:"noopener noreferrer"}},[t._v("three.js docs"),e("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);