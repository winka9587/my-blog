(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{536:function(t,a,s){t.exports=s.p+"assets/img/20200306232331870.918865e3.jpg"},537:function(t,a,s){t.exports=s.p+"assets/img/20200306225645769.c7b92515.jpg"},538:function(t,a,s){t.exports=s.p+"assets/img/20200306235058415.6ee75e53.jpg"},539:function(t,a,s){t.exports=s.p+"assets/img/20200307000321722.f872c5e4.jpg"},540:function(t,a,s){t.exports=s.p+"assets/img/20200307000410459.d6e4fdd3.jpg"},541:function(t,a,s){t.exports=s.p+"assets/img/20200307000449848.986b747e.jpg"},542:function(t,a,s){t.exports=s.p+"assets/img/20200307000529982.df3cdb50.jpg"},543:function(t,a,s){t.exports=s.p+"assets/img/20200306234821687.0ebe9d99.jpg"},544:function(t,a,s){t.exports=s.p+"assets/img/20200306234736416.287711b8.jpg"},590:function(t,a,s){"use strict";s.r(a);var n=s(56),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"web上的mediarecorder更换stream-录制过程中切换摄像头"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web上的mediarecorder更换stream-录制过程中切换摄像头"}},[t._v("#")]),t._v(" Web上的MediaRecorder更换stream(录制过程中切换摄像头)")]),t._v(" "),n("p",[t._v("今天有人问:"),n("strong",[t._v("MediaRecorder在录制过程中，能否改变在构造函数中引入的流。")])]),t._v(" "),n("p",[t._v("这个我还真没有试过，之前写的H5直播虽然我一直声称在手机端可以选择前置或后置摄像头，但实际上一旦选择了就没法更改了......其实我确实有考虑过解决这个问题，但当时实在是太累(lan)了，最后答辩就给糊弄过去了，难得今天不想干正事，试试。")]),t._v(" "),n("h2",{attrs:{id:"过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#过程"}},[t._v("#")]),t._v(" 过程")]),t._v(" "),n("p",[t._v("首先直接MediaRecorder.stream=new_stream的想法可以省省，不用猜就知道这里面的stream肯定是个只读属性")]),t._v(" "),n("p",[n("img",{attrs:{src:s(536),alt:"img"}}),n("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),n("p",[t._v("一般遇到这种问题我都先去网上看看有没有什么高见，看见这么一个："),n("a",{attrs:{href:"https://stackoverflow.com/questions/57838283/is-it-possible-to-change-mediarecorders-stream?r=SearchResults",target:"_blank",rel:"noopener noreferrer"}},[t._v("web audio api - Is it possible to change MediaRecorder's stream? - Stack Overflow"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("img",{attrs:{src:s(537),alt:"img"}}),n("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),n("p",[t._v("老哥上来就说做不到，emmmmmmmm....但是提问的人问的是track，我觉得可能跟我想的是不一样的，动手试试吧。既然没法修改stream，我直接new一个新的MediaRecorder替换原来的不可以吗？")]),t._v(" "),n("p",[t._v("记得之前看示例的时候有一个是教如何切换使用的设备的（"),n("a",{attrs:{href:"https://webrtc.github.io/samples/src/content/devices/input-output/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Choose camera, microphone and speaker"),n("OutboundLink")],1),t._v("），里面演示了如何切换设备以及切换后的效果，怎么实现的并不重要，没那么多时间去细细品味，扒下来代码，找到自己以前写的MediaRecorder的代码，拿出作为代码人的骄傲，开始写一个缝合怪。写到饭点，看完API的顺道去看了一下自己的Chrome版本，放那里没管吃饭去了，回来一看Chrome界面不对，自己给我更新了……更新完之后发现最早写的MediaRecorder代码不管用了我日，好在还有另一份使用blob的还可以，得重新写自己的缝合怪了")]),t._v(" "),n("p",[t._v("写完之后大概是这样的：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(538),alt:"img"}}),t._v(" 上面的video标签显示的是当前调用的摄像头的实时图像，下面的video标签播放的是使用MediaRecorder录制的，\n点击Record按钮MediaRecorder就会开始工作，stop为结束录制，printstate是测试用的，在控制台打印状态信息"),n("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),n("p",[t._v("在魔改原来sample代码的过程中，我在设备下拉菜单的事件触发函数里加上了代码，在设备改变之后，new一个新的MediaRecorder替代原来的，将新的设备的stream作为MediaRecorder的参数传入，将其绑定起来。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gotStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这个函数跟在getUserMedia之后，参数中的stream就是新设备的stream")]),t._v("\n    \n        window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stream "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// make stream available to console")]),t._v("\n        videoElement"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("srcObject "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在上面的video标签中显示")]),t._v("\n  \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//缝合怪")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化MediaRecorder")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" record_options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("audioBitsPerSecond")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("128000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("videoBitsPerSecond")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2500000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mimeType")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mimeType_for_test\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建MediaRecorder")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//注意MediaRecorder已经在js文件的开头声明")]),t._v("\n\t\tmediaRecorder"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MediaRecorder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("record_options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当录制的数据可用时")]),t._v("\n\t\tmediaRecorder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("ondataavailable")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//console.log(e.data);")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\t\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" reader "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileReader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" arr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\tarr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" blob "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Blob")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("mimeType_for_test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\treader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readAsArrayBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t\n\t\t\t\treader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onloadend")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\tsourcebuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t\tsourcebuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'updateend'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//mediaRecorder.start(timecell);")]),t._v("\n\tmediaRecorder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onstart")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Record onstart'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    mediaRecorder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onstop")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Record onstop'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//缝合怪的尾巴")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" navigator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mediaDevices"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("enumerateDevices")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//用于后面的函数更新设备标签")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("实际运行起来就遇到了很操蛋的问题")]),t._v(" "),n("h2",{attrs:{id:"mediarecorder无法start"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mediarecorder无法start"}},[t._v("#")]),t._v(" MediaRecorder无法start")]),t._v(" "),n("p",[t._v("在录制过程中直接用new MediaRecorder替换原来的会导致下面的播放卡住，即便sourcebuffer一直在不停地append但是无法播放，于是我考虑是不是在改变stream之前将录制停止，new完之后再重新开始录制。当我这么做了之后遇到了下面的问题：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(539),alt:"img"}}),n("img",{attrs:{src:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",alt:"点击并拖拽以移动"}})]),t._v(" "),n("p",[t._v("于是我分阶段在控制台中打印MediaRecorder，检查它的状态")]),t._v(" "),n("p",[n("img",{attrs:{src:s(540),alt:"img"}}),t._v(" 正常录制过程中")]),t._v(" "),n("p",[n("img",{attrs:{src:s(541),alt:"img"}}),t._v(" 刚刚用new MediaRecorder切换完stream后")]),t._v(" "),n("p",[n("img",{attrs:{src:s(542),alt:"img"}}),t._v(" 切换完过了一段时间之后")]),t._v(" "),n("p",[t._v("对比上面三个可以发现，在刚刚切换完stream之后，MediaRecorder下的stream属性下的active属性值是false，当一段时间过后才会变为true，当其为false时试图调用MediaRecorder.start()就会导致报错。我看到了active下面还有个onactive，诶嘿嘿这个好东西啊，这不就是active变为true时的触发事件吗，赶紧绑定函数，变为true时就启动我的MediaRecorder！")]),t._v(" "),n("p",[t._v("过了好久好久")]),t._v(" "),n("p",[t._v("“onactive还没有被实现.......”，我靠了这帮人为什么这么喜欢挖坑不填啊。被逼无奈，在切换stream后等待，当stream.active的值为true时再start我的MediaRecorder。（这里又被自己蠢到了，代码苦手最近C++写太多了，我直接写了个while(1)里面写了个判断跳出循环，然后直接把页面给卡死了....蠢到自己不自知以为是页面开太多了头铁地又试了一次...）写个setTimeout完事")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryRestartRecorder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaRecorder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("active"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tmediaRecorder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timecell"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tryRestartRecorder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("changestream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tmediaRecorder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//防止MediaRecorder还没有初始化")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//切换stream的函数")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryRestartRecorder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这样就成了，切换音频输入输出同理。")]),t._v(" "),n("h3",{attrs:{id:"navigator-mediadevices-enumeratedevices-不显示设备名称"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#navigator-mediadevices-enumeratedevices-不显示设备名称"}},[t._v("#")]),t._v(" navigator.mediaDevices.enumerateDevices()不显示设备名称")]),t._v(" "),n("p",[t._v("收尾的时候发现不显示设备名称")]),t._v(" "),n("p",[n("img",{attrs:{src:s(543),alt:"img"}})]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/ihtml5/article/details/88693446",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个博客"),n("OutboundLink")],1),t._v("里面提到需要部署到服务器上去才能够获取到设备名称，可能是因为不是https连接导致navigator.mediaDevices.enumerateDevices()函数没有权限")]),t._v(" "),n("p",[n("img",{attrs:{src:s(544),alt:"img"}})]),t._v(" "),n("h2",{attrs:{id:"demo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[t._v("#")]),t._v(" Demo")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://winka9587.github.io/MediaRecorder_changestream_sample/",target:"_blank",rel:"noopener noreferrer"}},[t._v("demo地址"),n("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);